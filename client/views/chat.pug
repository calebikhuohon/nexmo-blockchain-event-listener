doctype html
html
  head
    title Nexmo Chat
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.css')
    link(rel='stylesheet', href='css/main.css')
    script(src='./node_modules/nexmo-client/dist/nexmoClient.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js')
    script(src='scripts/main.js')
  body
    h1#wallet.no-show #{wallet}
    #chat-app
      #chat.has-text-centered
        section.blue-background.white.large-text
          .hero-body
            .container
              h1.white Nexmo Chat
              h2 Chat Application on the Blockchain using Nexmo
        h3#status.error
        section.section.chat-container
          .container
            .columns
              .box.column.is-8.is-offset-2
                div#spinner.lds-dual-ring
                h2.title Chatbox
                .chat-messages.has-text-left
                  ul#chat-messages
                form
                  .field.has-addons
                    p.control
                      input(type='text', class='input', value='Pirulo', id='name' disabled)
                    p.control.is-expanded
                      input(type='text', class='input', placeholder='Try to say something', id='message')
                    p.control
                      input(type='submit', class='button is-success', value='Post')
                
        script.
          (async function() {
            let nexmo = new NexmoClient();
            let app = nexmo.login('jwt');
            let conversation = app.getConversation('convId')
            // Send message
            $('form').submit(function() {
                const name = JSON.parse($('#wallet').text()).address
                const message = $('#message').val();
                // Send message
            
            conversation.sendCustomEvent({type: 'text'}).then((customEvent) => {
              console.log(customEvent)
            })
  
                $('#message').val('');
                return false;
            });
          })();
            

        script.
            // Update error
            (async function() {
              let nexmo = new NexmoClient();
              let app = await nexmo.login('jwt');
              let conversation = await app.getConversation('convId')

              conversation.on('text:delivered', (from, event) => {
                console.log(event.body);
                var username = message.name
              $('#chat-messages').append($('<li>').text(`${username} : ${message.content}`));
              });
            })();

            //- socket.on('error-update', function(message) {
            //-   $('#spinner').hide()
            //-   $('#status').text(message.content)
            //- });
            //- // Update chat
            //- socket.on('chatter', function(message) {
            //-   var username = formatUsername(message.name)
            //-   $('#chat-messages').append($('<li>').text(`${username} : ${message.content}`));
            //- });
            //- // Update status
            //- socket.on('status-update', function(message) {
            //-   $('#status').text()
            //- });
            //- // Stop spinner
            //- socket.on('stop-spinner', function() {
            //-   $('#spinner').hide()
            
            
  script.
           // Update Username
            const account = JSON.parse($('#wallet').text())
            $('#name').val(account.address)
            $( document ).ready(function() {
            // Request chat update
              conversavtion.sendCustomEvent({type: 'text:delivered'}).then((customEvent) => {
                console.log(customEvent)
              });
            });
      

                